<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>히스토리 계산기 (라이트모드)</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter 폰트 설정 및 라이트 모드 스타일 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6; /* Light Gray Background */
        }
        
        /* 라이트 모드 키 색상 정의 */
        .key { 
            background-color: #FFFFFF; /* White Number/Decimal Key */
            color: #1F2937; /* Dark Text */
            transition: transform 0.1s;
        }
        .key:active { transform: scale(0.95); }

        .operator { 
            background-color: #E5E7EB; /* Gray-200 Operator Key */
            color: #1F2937; 
            transition: transform 0.1s;
        }
        .operator:active { transform: scale(0.95); }

        /* C, (), ±, ⌫ 버튼 스타일 */
        .utility-key {
            background-color: #D1D5DB; /* Gray-300 Utility Key */
            color: #1F2937;
            transition: transform 0.1s;
        }
        .utility-key:active { transform: scale(0.95); }

        .equal { 
            background-color: #10B981; /* Emerald-500 Green Equal Key */
            color: #FFFFFF; /* White Text for contrast */
            transition: transform 0.1s;
        }
        .equal:active { transform: scale(0.95); }

        .clear-key { 
            background-color: #EF4444; /* Red-500 C key */
            color: white; 
            transition: transform 0.1s;
        }
        .clear-key:active { transform: scale(0.95); }

        /* 디스플레이 스타일 */
        #display {
            background-color: #FFFFFF; /* White Display Background */
            color: #1F2937; /* Dark Text */
            border: 1px solid #D1D5DB; /* Subtle border */
        }
        #previous-op {
            color: #6B7280; /* Gray-500 for previous op */
        }
        #current-op {
            color: #1F2937; /* Dark Text for current op */
        }

        /* 히스토리 사이드바 (라이트 모드 적용) */
        .history-sidebar {
            background-color: #FFFFFF; /* White History Background */
            color: #1F2937; /* Dark Text */
            border: 1px solid #E5E7EB;
        }
        .history-sidebar h2 {
            color: #1F2937;
        }
        .history-sidebar .border-b {
            border-color: #D1D5DB; /* Light gray border for separator */
        }
        .history-item-dark {
            /* History item styling - using dark class but light colors */
            background-color: #F9FAFB; /* Off-white background for history item */
            border-color: #E5E7EB; 
            color: #1F2937;
        }
        .history-item-dark:hover {
            background-color: #EFF6FF; /* Subtle blue hover effect */
        }
        .history-item-dark .text-gray-500 {
             color: #6B7280; /* Darker gray for previous expression */
        }
        .history-item-dark .text-gray-900 {
            color: #1F2937; /* Dark text for result */
        }
        .history-sidebar .text-gray-500 {
            color: #6B7280; /* Text for empty history message */
        }
        
        /* 스크롤바 숨기기 */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* 모바일 우선 반응형 레이아웃 */
        .main-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 40rem; 
            margin: 0 auto;
        }
        @media (min-width: 768px) {
            .main-grid {
                flex-direction: row;
                gap: 1.5rem;
                max-width: 65rem; /* 너비 확장 */
                align-items: flex-start;
            }
            .calculator-card {
                flex: 1; 
                min-width: 384px; 
            }
            .history-sidebar {
                flex: 1; 
                max-height: 90vh; 
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="min-h-screen pt-8 p-4 md:p-8">

    <div class="main-grid">
        <!-- Calculator Card (Left/Top) -->
        <div id="calculator" class="calculator-card w-full max-w-sm bg-white shadow-xl p-5 rounded-3xl transition-all duration-300 mx-auto">
            <!-- Display -->
            <div id="display" class="mb-4 rounded-2xl p-4 flex flex-col items-end justify-end font-light overflow-x-auto whitespace-nowrap scrollbar-hide" style="height: 5rem;">
                <div id="previous-op" class="text-sm h-6"></div>
                <div id="current-op" class="text-4xl font-normal h-10">0</div>
            </div>

            <!-- Button Grid (Image-based Layout) -->
            <div id="main-button-grid" class="grid grid-cols-4 gap-3">
                
                <!-- Row 1: C, (), ÷, ⌫ (Backspace) -->
                <button class="clear-key text-white text-2xl p-5 aspect-square rounded-full shadow-md" onclick="clearDisplay()">C</button>
                <button class="utility-key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="paren">()</button>
                <button class="operator text-2xl p-5 aspect-square rounded-full shadow-md" data-value="/">÷</button>
                <button class="utility-key text-2xl p-5 aspect-square rounded-full shadow-md" onclick="deleteLast()">⌫</button>
                
                <!-- Row 2: 7, 8, 9, × -->
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="7">7</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="8">8</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="9">9</button>
                <button class="operator text-2xl p-5 aspect-square rounded-full shadow-md" data-value="*">×</button>

                <!-- Row 3: 4, 5, 6, - -->
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="4">4</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="5">5</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="6">6</button>
                <button class="operator text-2xl p-5 aspect-square rounded-full shadow-md" data-value="-">-</button>

                <!-- Row 4: 1, 2, 3, + -->
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="1">1</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="2">2</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="3">3</button>
                <button class="operator text-2xl p-5 aspect-square rounded-full shadow-md" data-value="+">+</button>
                
                <!-- Row 5: +/-, 0, ., = -->
                <button class="utility-key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="plusminus">±</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value="0">0</button>
                <button class="key text-2xl p-5 aspect-square rounded-full shadow-md" data-value=".">.</button>
                <button class="equal text-2xl p-5 aspect-square rounded-full shadow-md" onclick="calculate()">=</button> 
            </div>
        </div>

        <!-- History Sidebar (Right/Bottom) -->
        <div class="history-sidebar w-full md:w-96 bg-white shadow-xl rounded-3xl p-5 overflow-y-auto">
            <div class="mb-4 border-b pb-2">
                <h2 class="text-xl font-bold">계산 기록 (History)</h2>
            </div>
            
            <!-- History List -->
            <div id="history-list" class="space-y-3">
                <!-- History items will be inserted here -->
                <p id="history-empty" class="text-gray-500 text-center text-sm mt-8">기록이 없습니다.</p>
            </div>
        </div>
    </div>

    <script>
        // JavaScript for Calculator Logic
        const currentOpDisplay = document.getElementById('current-op');
        const previousOpDisplay = document.getElementById('previous-op');
        const historyList = document.getElementById('history-list');
        // 'historySidebar', 'toggleIcon' 등 히스토리 숨김 관련 변수 제거됨.

        let currentExpression = '';
        let resultDisplayed = false;
        let history = [];
        let openParentheses = 0; // 괄호 카운터

        // 상수 정의
        const LAST_CALCULATION_KEY = 'last_calculation';
        const HISTORY_KEY = 'calculation_history';
        // 히스토리 가시성 관련 상수 제거됨.

        // --- 초기화 및 데이터 로드 ---
        window.onload = function() {
            loadState();
            renderHistory();
            
            //


