#!/bin/bash

# 1. ë°ì´í„° íŒŒì‹±: ê°’(Yì¶•)ê³¼ ë ˆì´ë¸”(Xì¶•) ë¶„ë¦¬
# JS_VALUES: ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ê°’ (ì˜ˆ: 2133300, 2133300)
JS_VALUES=$(awk -F ' : ' '{ gsub(/,/, "", $2); if (NR==1) {printf $2} else {printf ", %s", $2} }' result.txt)

# JS_LABELS: ë”°ì˜´í‘œë¡œ ê°ì‹¸ê³  ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ì‹œê°„ (ì˜ˆ: "21:08 KST", "21:09 KST")
JS_LABELS=$(awk -F ' : ' '{ 
    split($1, time_arr, " "); 
    short_label = time_arr[2] " " time_arr[3]; 
    if (NR==1) {printf "\"%s\"", short_label} else {printf ", \"%s\"", short_label} 
}' result.txt)

# 2. HTML íŒŒì¼ ìƒì„±
cat << CHART_END > chart.html
<!DOCTYPE html>
<html>
<head>
    <title>ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ì°¨íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #chartContainer { width: 90%; max-width: 1000px; margin: auto; }
    </style>
</head>
<body>
    <h1>ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ë³€í™” ì¶”ì´ (KST)</h1>
    <div id="chartContainer">
        <canvas id="simpleChart"></canvas>
    </div>
    
    <script>
    // ğŸš¨ 1. ë°ì´í„°: ë‹¨ìˆœ ìˆ«ì ë°°ì—´ (JS_VALUES)
    const chartData = [${JS_VALUES}];
    
    // ğŸš¨ 2. ë ˆì´ë¸”: ë‹¨ìˆœ ë¬¸ìì—´ ë°°ì—´ (JS_LABELS)
    const chartLabels = [${JS_LABELS}];

    const ctx = document.getElementById('simpleChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartLabels, // Xì¶• ë ˆì´ë¸” ì‚¬ìš©
            datasets: [{
                label: 'ê°’ ë³€í™” ì¶”ì´',
                data: chartData,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderWidth: 2,
                tension: 0.1,
                pointRadius: 3
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    // ğŸš¨ time ì¶• ëŒ€ì‹  ê¸°ë³¸ category ì¶• ì‚¬ìš©
                    type: 'category', 
                    title: { display: true, text: 'ì‹œê°„ (HH:MM KST)' }
                },
                y: {
                    title: { display: true, text: 'ê°’' },
                    beginAtZero: false,
                    ticks: {
                        callback: function(value) {
                            // Yì¶• ê°’ì— ì‰¼í‘œ ì¶”ê°€
                            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += context.parsed.y.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                            }
                            return label;
                        }
                    }
                }
            }
        }
    });
    </script>
</body>
</html>
CHART_END
