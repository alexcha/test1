name: Streaming list update

on: 
  push:
  schedule:
    - cron: '5 * * * *'
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    # ... (ìƒëµëœ Checkout, Unittest ìŠ¤í…) ...
      
    - name: Commit files and Generate Chart
      run: |
        echo "í˜„ì¬ Ref: ${{ github.ref }}"
        
        # 1. íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° í™˜ê²½ ì„¤ì • (ìƒëµ)
        WGET_URL="https://raw.githubusercontent.com/alexcha/test1/main/check.sh"
        echo "ë‹¤ìš´ë¡œë“œ ì‹œë„ URL: $WGET_URL"
        wget "$WGET_URL" -O check.sh || { echo "ERROR: File download failed." >&2; exit 1; }
        
        export LANG=ko_KR.UTF-8
        sudo apt-get -y update
        sudo apt-get -y install html2text
        
        chmod +x check.sh
        ./check.sh >> result.txt
        
        # ----------------------------------------------------
        # 2. ì°¨íŠ¸ ìƒì„± ë¡œì§ ì‹œì‘
        # ----------------------------------------------------
        
        # ë°ì´í„° íŒŒì‹± ë° JavaScript ë°°ì—´ í¬ë§·ìœ¼ë¡œ ë³€í™˜ (JS_DATA)
        # ğŸš¨ ìˆ˜ì •: awk ëª…ë ¹ì˜ ë”°ì˜´í‘œ ì¶©ëŒ ìœ„í—˜ì„ ì¤„ì´ê¸° ìœ„í•´ êµ¬ì¡°ë¥¼ ëª…í™•íˆ í•¨
        JS_DATA=$(awk -F ' : ' '
            {
                timestamp = $1
                value = $2
                gsub(/,/, "", value)
                
                if (NR == 1) {
                    printf "{"
                } else {
                    printf ", {"
                }
                printf "x: \"%s\", y: %s}", timestamp, value
            } END {
                printf ""
            }' result.txt)

        # HTML íŒŒì¼ ìƒì„± (Bash ë³€ìˆ˜ ì‚½ì… ì˜¤ë¥˜ ë°©ì§€ìš© ë§ˆì»¤ ì‚¬ìš©)
        cat << 'CHART_HTML_END_MARKER' > chart.html # <--- ì´ ì¤„ì´ 64ë²ˆì§¸ ì¤„ ê·¼ì²˜ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ... (HTML ë° JavaScript ì½”ë“œ ìƒëµ) ...
# ... (Git ì»¤ë°‹ ë° í‘¸ì‹œ ë¡œì§ ìƒëµ) ...
