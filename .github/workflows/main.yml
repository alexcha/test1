name: Streaming list update

on: 
  push:
    # ëª¨ë“  ë¸Œëœì¹˜ í‘¸ì‹œì— ëŒ€í•´ ì‹¤í–‰
  schedule:
    # ğŸš¨ ìˆ˜ì •: ë§¤ ì‹œê°„ 00ë¶„ì— ì‹¤í–‰ë˜ë„ë¡ ë³€ê²½
    - cron: '0 * * * *'
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Github Action gen-sh-unittest
      id: action-gen-sh-unittest
      uses: vargiuscuola/gen-sh-unittest@master
      
    - name: gensh-unittest result
      run: echo "The result of gensh-unittest Action was ${{ steps.action-gen-sh-unittest.outputs.result }}"
      
    - name: Commit files
      run: |
        echo "í˜„ì¬ Ref: ${{ github.ref }}"
        
        # 1. íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ê³µê°œ ì €ì¥ì†Œ)
        WGET_URL="https://raw.githubusercontent.com/alexcha/test1/main/check.sh"
        echo "ë‹¤ìš´ë¡œë“œ ì‹œë„ URL: $WGET_URL"
        
        wget "$WGET_URL" -O check.sh || { 
          echo "ğŸš¨ğŸš¨ğŸš¨ ERROR: íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨. URLì„ í™•ì¸í•˜ì„¸ìš”. ğŸš¨ğŸš¨ğŸš¨"
          exit 1
        }
        
        # 2. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í™˜ê²½ ì„¤ì • ë° ì˜ì¡´ì„± ì„¤ì¹˜
        export LANG=ko_KR.UTF-8
        # ğŸš¨ sudoë¥¼ ì‚¬ìš©í•˜ì—¬ ê¶Œí•œ ì˜¤ë¥˜ í•´ê²°
        sudo apt-get -y update
        sudo apt-get -y install html2text
        
        chmod +x check.sh
        
        # 3. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë° ê²°ê³¼ íŒŒì¼ ìƒì„±
        ./check.sh > result.txt

        # 4. Git ì„¤ì • ë° ì»¤ë°‹
        git add result.txt
        
        git config --global user.email test@local
        git config --global user.name test

        if git diff --cached --exit-code; then
          echo "No changes to commit"
        else
          git commit -m "Automated update: new data commit"
          git branch -M main
          
          # 5. git push: ê¸°ë³¸ ì¸ì¦ì„ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì €ì¥ì†Œì— í‘¸ì‹œ
          git push
        fi
        
    - name: Push changes
      # ì´ì „ ìŠ¤í…ì—ì„œ ì´ë¯¸ í‘¸ì‹œí–ˆìœ¼ë¯€ë¡œ ë¹„í™œì„±í™”
      if: false 
      uses: ad-m/github-push-action@v5 
      with:
        github_token: ${{ secrets.ETC_KEY }}
